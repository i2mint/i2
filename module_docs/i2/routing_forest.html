<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>i2.routing_forest &mdash; i2 0.1.23 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=20522496"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="i2.scrap" href="scrap.html" />
    <link rel="prev" title="i2.multi_object" href="multi_object.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            i2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../i2.html">i2</a></li>
<li class="toctree-l1"><a class="reference internal" href="_deprecated.html">i2._deprecated</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">i2.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain_map.html">i2.chain_map</a></li>
<li class="toctree-l1"><a class="reference internal" href="deco.html">i2.deco</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_mint.html">i2.doc_mint</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">i2.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">i2.examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/signature_calculus.html">i2.examples.signature_calculus</a></li>
<li class="toctree-l1"><a class="reference internal" href="footprints.html">i2.footprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="io_trans.html">i2.io_trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="itypes.html">i2.itypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_path.html">i2.key_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_object.html">i2.multi_object</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">i2.routing_forest</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.CondNode"><code class="docutils literal notranslate"><span class="pre">CondNode</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.DelegateToMappingAttrMixin"><code class="docutils literal notranslate"><span class="pre">DelegateToMappingAttrMixin</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.FeatCondNode"><code class="docutils literal notranslate"><span class="pre">FeatCondNode</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i2.routing_forest.FeatCondNode.from_feature_val_map"><code class="docutils literal notranslate"><span class="pre">FeatCondNode.from_feature_val_map()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.FinalNode"><code class="docutils literal notranslate"><span class="pre">FinalNode</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.KeyFuncMapping"><code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i2.routing_forest.KeyFuncMapping.default_factory"><code class="docutils literal notranslate"><span class="pre">KeyFuncMapping.default_factory()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.RoutingForest"><code class="docutils literal notranslate"><span class="pre">RoutingForest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.RoutingNode"><code class="docutils literal notranslate"><span class="pre">RoutingNode</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i2.routing_forest.RoutingNode.from_object"><code class="docutils literal notranslate"><span class="pre">RoutingNode.from_object()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.SwitchCaseNode"><code class="docutils literal notranslate"><span class="pre">SwitchCaseNode</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2.routing_forest.return_sentinel"><code class="docutils literal notranslate"><span class="pre">return_sentinel()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scrap.html">i2.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/scrap.html">i2.scrap.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/scrap_ch_variadics.html">i2.scrap.scrap_ch_variadics</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/scrap_kwargs.html">i2.scrap.scrap_kwargs</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/signature_bops.html">i2.scrap.signature_bops</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/simple_pymint.html">i2.scrap.simple_pymint</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/switch_case_tree.html">i2.scrap.switch_case_tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">i2.signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">i2.tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/footprints_test.html">i2.tests.footprints_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/objects_for_testing.html">i2.tests.objects_for_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/signatures_test.html">i2.tests.signatures_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_util.html">i2.tests.test_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_wrapper.html">i2.tests.test_wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/util.html">i2.tests.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">i2.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrapper.html">i2.wrapper</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">i2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">i2.routing_forest</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module_docs/i2/routing_forest.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-i2.routing_forest">
<span id="i2-routing-forest"></span><h1>i2.routing_forest<a class="headerlink" href="#module-i2.routing_forest" title="Link to this heading"></a></h1>
<p>Tools to specify functions through trees and forests.</p>
<p>Whaaa?!?</p>
<p>Well, you see, often – especially when writing transformers – you have a series of
if/then conditions nested into eachother, in code, where it gets ugly and un-reusable.</p>
<p>This module explores ways to objectivy this: That is, to give us the means to create
such nested conditions in a way that we can define the parts as reusable operable
components.</p>
<p>Think of the relationship between the for loop (code) and the iterator (object), along
with iterator tools (itertools).
This is what we’re trying to explore, but for if/then conditions.</p>
<p>I said explore. Some more work is needed here to make it robust and easily usable.</p>
<p>Let’s look at an example involving the three main actors of our play.
Each of these are <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> and <code class="docutils literal notranslate"><span class="pre">Callable</span></code> (<code class="docutils literal notranslate"><span class="pre">Generator</span></code> to be precise).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CondNode</span></code>: implements the if/then (no else) logic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FinalNode</span></code>: Final – yields (both with call and iter) it’s single <cite>.val</cite> attribute.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RoutingForest</span></code>: An Iterable of <code class="docutils literal notranslate"><span class="pre">CondNode</span></code></p></li>
</ul>
<p>You’ll note that instances of these classes are all both callables and iterables,
and that when called, they return iterables.
It’s this aspect that makes us be able to nest conditions within conditions,
and further, control the flow of the iteration from outside.
A routing node (or forest) called on an object will yield all values that match the
conditions that were specified for it.
For example, if you need all matches, you can wrap it with <code class="docutils literal notranslate"><span class="pre">list</span></code>, if you need the
first match only, you can wrap it with <code class="docutils literal notranslate"><span class="pre">next</span></code>, if you have a default value,
you can wrap it in <code class="docutils literal notranslate"><span class="pre">next</span></code> with a default value.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">could_be_int</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">b</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">could_be_float</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">b</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">could_be_int</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_int</span><span class="p">(</span><span class="mf">30.3</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_int</span><span class="p">(</span><span class="s1">&#39;30.2&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_int</span><span class="p">(</span><span class="s1">&#39;nope&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">could_be_int</span>
<span class="go">could_be_int</span>
<span class="go">True True False False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">could_be_float</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_float</span><span class="p">(</span><span class="mf">30.3</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_float</span><span class="p">(</span><span class="s1">&#39;30.2&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">could_be_float</span><span class="p">(</span><span class="s1">&#39;nope&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">could_be_float</span>
<span class="go">could_be_float</span>
<span class="go">could_be_float</span>
<span class="go">True True True False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">could_be_int</span><span class="p">(</span><span class="s1">&#39;30.2&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">could_be_float</span><span class="p">(</span><span class="s1">&#39;30.2&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
<span class="go">could_be_float</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">st</span> <span class="o">=</span> <span class="n">RoutingForest</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">CondNode</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">cond</span><span class="o">=</span><span class="n">could_be_int</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">then</span><span class="o">=</span><span class="n">RoutingForest</span><span class="p">(</span>
<span class="gp">... </span>                <span class="p">[</span>
<span class="gp">... </span>                    <span class="n">CondNode</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;More than a digit&#39;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">),</span>
<span class="gp">... </span>                    <span class="n">CondNode</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">),</span>
<span class="gp">... </span>                <span class="p">]</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">CondNode</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="n">could_be_float</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;could be seen as a float&#39;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="s1">&#39;nothing I can do with that&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="go">could_be_int</span>
<span class="go">could_be_float</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">,</span> <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="go">could_be_int</span>
<span class="go">could_be_float</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;More than a digit&#39;</span><span class="p">,</span> <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="go">could_be_int</span>
<span class="go">could_be_float</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="s1">&#39;More than a digit&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="go">could_be_int</span>
<span class="go">could_be_float</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;### RoutingForest ########################################################################################&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">### RoutingForest ########################################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rf</span> <span class="o">=</span> <span class="n">RoutingForest</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">SwitchCaseNode</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">)},</span>
<span class="gp">... </span>            <span class="n">default</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">SwitchCaseNode</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;even&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;odd&#39;</span><span class="p">)},</span>
<span class="gp">... </span>            <span class="n">default</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;that is not an int&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.CondNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">CondNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">then</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#CondNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.CondNode" title="Link to this definition"></a></dt>
<dd><p>A RoutingNode that implements the if/then (no else) logic</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.DelegateToMappingAttrMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">DelegateToMappingAttrMixin</span></span><a class="reference internal" href="../../_modules/i2/routing_forest.html#DelegateToMappingAttrMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.DelegateToMappingAttrMixin" title="Link to this definition"></a></dt>
<dd><p>A mixin to delegate <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> methods to a mapping attribute called <code class="docutils literal notranslate"><span class="pre">mapping</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.FeatCondNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">FeatCondNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Obj</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Feature</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat_cond_thens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Feature</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#FeatCondNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.FeatCondNode" title="Link to this definition"></a></dt>
<dd><p>A RoutingNode that yields multiple routes, one for each of several conditions
met, where the condition is computed implements computes a feature of the obj and
according to an iterable of conditions on the feature.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fcn</span> <span class="o">=</span> <span class="n">FeatCondNode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">feat</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">feat_cond_thens</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;zero_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;one_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;two_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;three_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;four_mod_5&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;two_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;three_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;four_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">fcn</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">]</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="i2.routing_forest.FeatCondNode.from_feature_val_map">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_feature_val_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat_cond_thens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">Feature</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#FeatCondNode.from_feature_val_map"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.FeatCondNode.from_feature_val_map" title="Link to this definition"></a></dt>
<dd><p>A FeatCondNode where the conditions are equality checks on the feature value</p>
<p># &gt;&gt;&gt; fvn = FeatCondNode.from_feature_val_map(
# …     feat=lambda x: x % 3,
# …     feat_cond_thens={
# …         0: lambda x: ‘zero_mod_3’,
# …         1: lambda x: ‘one_mod_3’,
# …         2: lambda x: ‘two_mod_3’,
# …     }
# … )
# &gt;&gt;&gt; list(fvn(0))
#
# &gt;&gt;&gt; assert list(fvn(0)) == [‘zero_mod_3’]
# &gt;&gt;&gt; assert list(fvn(1)) == [‘one_mod_3’]
# &gt;&gt;&gt; assert list(fvn(2)) == [‘two_mod_3’]
#</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.FinalNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">FinalNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#FinalNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.FinalNode" title="Link to this definition"></a></dt>
<dd><p>A RoutingNode that is final.
It yields (both with call and iter) it’s single <cite>.val</cite> attribute.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.KeyFuncMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">KeyFuncMapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapping:</span> <span class="pre">~typing.MutableMapping</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">identity&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_factory:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">return_sentinel&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#KeyFuncMapping"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.KeyFuncMapping" title="Link to this definition"></a></dt>
<dd><p>Implements a switch-case-like mapping with a callable key function.</p>
<p>The purpose of <code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code> is to  allow switch-case logic to be
given as a plugin specification.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.routing_forest</span> <span class="kn">import</span> <span class="n">KeyFuncMapping</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_extension</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span> <span class="o">=</span> <span class="n">KeyFuncMapping</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;csv&#39;</span><span class="p">:</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;xls&#39;</span><span class="p">:</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;wav&#39;</span><span class="p">:</span> <span class="s1">&#39;audio&#39;</span><span class="p">},</span> <span class="n">key</span><span class="o">=</span><span class="n">get_extension</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Calling a <code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code> instance will call the <code class="docutils literal notranslate"><span class="pre">key</span></code> function on the input,
then look up the result in the <code class="docutils literal notranslate"><span class="pre">mapping</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span><span class="p">(</span><span class="s1">&#39;my_file.csv&#39;</span><span class="p">)</span>
<span class="go">&#39;table&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span><span class="p">(</span><span class="s1">&#39;another_file.xls&#39;</span><span class="p">)</span>
<span class="go">&#39;table&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span><span class="p">(</span><span class="s1">&#39;sound.wav&#39;</span><span class="p">)</span>
<span class="go">&#39;audio&#39;</span>
</pre></div>
</div>
<p>If the key is not found in the mapping, the <code class="docutils literal notranslate"><span class="pre">default_factory</span></code> is <strong>called</strong>
with the input and the result is returned. The default <code class="docutils literal notranslate"><span class="pre">default_factory</span></code> is
<code class="docutils literal notranslate"><span class="pre">return_sentinel</span></code>, which by default returns <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">data_type</span><span class="p">(</span><span class="s1">&#39;poem.txt&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Note that instances of <code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code> are also <code class="docutils literal notranslate"><span class="pre">Mapping``s,</span> <span class="pre">so</span> <span class="pre">all</span> <span class="pre">``Mapping</span></code>
methods can be used.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<span class="go">[&#39;csv&#39;, &#39;xls&#39;, &#39;wav&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<span class="go">{&#39;csv&#39;: &#39;table&#39;, &#39;xls&#39;: &#39;table&#39;, &#39;wav&#39;: &#39;audio&#39;}</span>
</pre></div>
</div>
<p>Including <code class="docutils literal notranslate"><span class="pre">update</span></code>, which constitutes a convenient way to extend the mapping.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">txt</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span><span class="p">(</span><span class="s1">&#39;poem.txt&#39;</span><span class="p">)</span>
<span class="go">&#39;text&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">default_factory</span></code> can be set to any callable, including a
<code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code> itself, which enables us to define an <code class="docutils literal notranslate"><span class="pre">else</span></code> for the
switch-case logic that a <code class="docutils literal notranslate"><span class="pre">KeyFuncMapping</span></code> implements.
Say, for example, if no handled extension is found, we want to check the protocol
of the input string instead. This is not only a new mapping, but also a new key
function. We can do it as such:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_protocol</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protocol</span> <span class="o">=</span> <span class="n">KeyFuncMapping</span><span class="p">({</span><span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;url&#39;</span><span class="p">},</span> <span class="n">get_protocol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_data_type</span> <span class="o">=</span> <span class="n">KeyFuncMapping</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data_type</span><span class="o">.</span><span class="n">mapping</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="n">protocol</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_data_type</span><span class="p">(</span><span class="s1">&#39;notes.txt&#39;</span><span class="p">)</span>
<span class="go">&#39;text&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_data_type</span><span class="p">(</span><span class="s1">&#39;https://www.python.org/&#39;</span><span class="p">)</span>
<span class="go">&#39;url&#39;</span>
</pre></div>
</div>
<p>Given how useful this pattern is, we made the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator implement this.
Note that here, <code class="docutils literal notranslate"><span class="pre">+</span></code> is not associative or commutative (as with numbers).
It should be understood to function more like the <code class="docutils literal notranslate"><span class="pre">+</span></code> for iterables like <code class="docutils literal notranslate"><span class="pre">list</span></code>
and <code class="docutils literal notranslate"><span class="pre">tuple</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nested</span> <span class="o">=</span> <span class="n">data_type</span> <span class="o">+</span> <span class="n">protocol</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nested</span><span class="p">(</span><span class="s1">&#39;https://www.python.org/&#39;</span><span class="p">)</span>
<span class="go">&#39;url&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nested</span><span class="p">(</span><span class="s1">&#39;jazz.wav&#39;</span><span class="p">)</span>
<span class="go">&#39;audio&#39;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="i2.routing_forest.KeyFuncMapping.default_factory">
<span class="sig-name descname"><span class="pre">default_factory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sentinel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#i2.routing_forest.KeyFuncMapping.default_factory" title="Link to this definition"></a></dt>
<dd><p>Return a constanc sentinel value when called. Use partial to set sentinel</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.RoutingForest">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">RoutingForest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#RoutingForest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.RoutingForest" title="Link to this definition"></a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rf</span> <span class="o">=</span> <span class="n">RoutingForest</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">CondNode</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
<span class="gp">... </span>             <span class="n">then</span><span class="o">=</span><span class="n">RoutingForest</span><span class="p">([</span>
<span class="gp">... </span>                 <span class="n">CondNode</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;More than a digit&#39;</span><span class="p">)),</span>
<span class="gp">... </span>                 <span class="n">CondNode</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">))])</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>    <span class="n">CondNode</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
<span class="gp">... </span>             <span class="n">then</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;could be seen as a float&#39;</span><span class="p">)),</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="s1">&#39;nothing I can do with that&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">,</span> <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;More than a digit&#39;</span><span class="p">,</span> <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;More than a digit&#39;</span><span class="p">,</span> <span class="s2">&quot;That&#39;s odd!&quot;</span><span class="p">,</span> <span class="s1">&#39;could be seen as a float&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.RoutingNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">RoutingNode</span></span><a class="reference internal" href="../../_modules/i2/routing_forest.html#RoutingNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.RoutingNode" title="Link to this definition"></a></dt>
<dd><p>A RoutingNode instance needs to be callable on a single object,
yielding an iterable or a final value</p>
<dl class="py method">
<dt class="sig sig-object py" id="i2.routing_forest.RoutingNode.from_object">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mini_lang=&lt;function</span> <span class="pre">_default_mini_lang&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#RoutingNode.from_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.RoutingNode.from_object" title="Link to this definition"></a></dt>
<dd><p>Converts an object to a RoutingNode instance.
Enables mini-languages to be developed for defining routing trees.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="i2.routing_forest.SwitchCaseNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">SwitchCaseNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">switch:</span> <span class="pre">~typing.Callable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cases:</span> <span class="pre">~typing.Mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default:</span> <span class="pre">~typing.Any</span> <span class="pre">=</span> <span class="pre">&lt;i2.routing_forest.NoDefault</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#SwitchCaseNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.SwitchCaseNode" title="Link to this definition"></a></dt>
<dd><p>A RoutingNode that implements the switch/case/else logic.
It’s just a specialization (enhanced with a “default” option) of the FeatCondNode
class to a situation where the cond function of feat_cond_thens is equality,
therefore the routing can be
implemented with a {value_to_compare_to_feature: then_node} map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>switch</strong> – A function returning the feature of an object we want to switch on</p></li>
<li><p><strong>cases</strong> – The mapping from feature to RoutingNode that should be yield for that</p></li>
</ul>
</dd>
</dl>
<p>feature. It is often a dict, but only requirement is that it implements the
<code class="docutils literal notranslate"><span class="pre">cases.get(val,</span> <span class="pre">default)</span></code> method.
:param default: Default RoutingNode to yield if no</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rf</span> <span class="o">=</span> <span class="n">RoutingForest</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">SwitchCaseNode</span><span class="p">(</span><span class="n">switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">)},</span>
<span class="gp">... </span>                   <span class="n">default</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">SwitchCaseNode</span><span class="p">(</span><span class="n">switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;even&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;odd&#39;</span><span class="p">)},</span>
<span class="gp">... </span>                   <span class="n">default</span><span class="o">=</span><span class="n">FinalNode</span><span class="p">(</span><span class="s1">&#39;that is not an int&#39;</span><span class="p">)),</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;one_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;default_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rf</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;zero_mod_5&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="i2.routing_forest.return_sentinel">
<span class="sig-prename descclassname"><span class="pre">i2.routing_forest.</span></span><span class="sig-name descname"><span class="pre">return_sentinel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sentinel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/routing_forest.html#return_sentinel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#i2.routing_forest.return_sentinel" title="Link to this definition"></a></dt>
<dd><p>Return a constanc sentinel value when called. Use partial to set sentinel</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="multi_object.html" class="btn btn-neutral float-left" title="i2.multi_object" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scrap.html" class="btn btn-neutral float-right" title="i2.scrap" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>