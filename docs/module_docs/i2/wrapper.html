<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>i2.wrapper &mdash; i2 0.0.79 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/toggleprompt.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="i2.util" href="util.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> i2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../i2.html">i2</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">i2.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain_map.html">i2.chain_map</a></li>
<li class="toctree-l1"><a class="reference internal" href="deco.html">i2.deco</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_mint.html">i2.doc_mint</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">i2.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">i2.examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/signature_calculus.html">i2.examples.signature_calculus</a></li>
<li class="toctree-l1"><a class="reference internal" href="footprints.html">i2.footprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="io_trans.html">i2.io_trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="itypes.html">i2.itypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_path.html">i2.key_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_object.html">i2.multi_object</a></li>
<li class="toctree-l1"><a class="reference internal" href="routing_forest.html">i2.routing_forest</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap.html">i2.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/scrap.html">i2.scrap.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/simple_pymint.html">i2.scrap.simple_pymint</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">i2.signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch_case_tree.html">i2.switch_case_tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">i2.tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/footprints_test.html">i2.tests.footprints_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/objects_for_testing.html">i2.tests.objects_for_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/signatures_test.html">i2.tests.signatures_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_util.html">i2.tests.test_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/wrapper_test.html">i2.tests.wrapper_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">i2.util</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">i2.wrapper</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">i2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>i2.wrapper</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module_docs/i2/wrapper.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-i2.wrapper">
<span id="i2-wrapper"></span><h1>i2.wrapper<a class="headerlink" href="#module-i2.wrapper" title="Permalink to this headline">¶</a></h1>
<p>A wrapper object and tools to work with it</p>
<p>How the <code class="docutils literal notranslate"><span class="pre">Wrap</span></code> class works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      *outer_args, **outer_kwargs
                 │
                 ▼
┌───────────────────────────────────┐
│              ingress              │
└───────────────────────────────────┘
                 │
                 ▼
      *inner_args, **inner_kwargs
                 │
                 ▼
┌───────────────────────────────────┐
│               func                │
└───────────────────────────────────┘
                 │
                 ▼
             func_output
                 │
                 ▼
┌───────────────────────────────────┐
│              egress               │
└───────────────────────────────────┘
                 │
                 ▼
            final_output
</pre></div>
</div>
<p>How the <code class="docutils literal notranslate"><span class="pre">Ingress</span></code> class (ingress templated function maker) works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      *outer_args, **outer_kwargs
                 │
                 ▼
┌───────────────────────────────────┐
│          outer_sig_bind           │
└───────────────────────────────────┘
                 │
                 ▼
          outer_all_kwargs
                 │
                 ▼
┌───────────────────────────────────┐
│            kwargs_trans           │
└───────────────────────────────────┘
                 │
                 ▼
          inner_all_kwargs
                 │
                 ▼
┌───────────────────────────────────┐
│          inner_sig_bind           │
└───────────────────────────────────┘
                 │
                 ▼
      *inner_args, **inner_kwargs
</pre></div>
</div>
<dl class="py class">
<dt id="i2.wrapper.Ingress">
<em class="property">class </em><code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">Ingress</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner_sig</span></em>, <em class="sig-param"><span class="n">kwargs_trans</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>dict<span class="p">]</span><span class="p">, </span>dict<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outer_sig</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#Ingress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.Ingress" title="Permalink to this definition">¶</a></dt>
<dd><p>The Ingress class offers a template for creating ingress classes.</p>
<p>Note that when writing a decorator with i2.wrapper, you’re usually better off
writing an ingress function for the purpose. As a result, your code will usually
be less complex, easier to read, and more efficient than using the Ingress class.</p>
<p>So why use the Ingress class at all? For one, because it’ll take care of some common
mechanics for you, so once you understand how to use it,
you’ll probably create a correct wrapper faster.</p>
<p>Further, if you’re writing a general wrapping tool (e.g. your own currying machine,
some rule-based input casting function, etc.) then you’ll find that using
Ingres will usually with on the complexity, readability and/or efficiency front.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.wrapper</span> <span class="kn">import</span> <span class="n">Ingress</span><span class="p">,</span> <span class="n">wrap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.wrapper</span> <span class="kn">import</span> <span class="n">InnerMapIngress</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Ingress = InnerMapIngress</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(w:=</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">) + (x:=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">) * (y:=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">) ** (z:=</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">) == </span><span class="si">{</span><span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;(w:=0) + (x:=1) * (y:=2) ** (z:=3) == 8&#39;</span>
</pre></div>
</div>
<p>Let’s say you wanted to dispatch this function to a command line interface,
or a webservice where all arguments are taken from the url.
The problem here is that this means that all incoming values will be strings
in that case.
Say you wanted all input values to be cast to ints. In that case you could do:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">trans_all_vals_to_ints</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cli_f</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">f</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ingress</span><span class="o">=</span><span class="n">Ingress</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">kwargs_trans</span><span class="o">=</span><span class="n">trans_all_vals_to_ints</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cli_f</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">)</span>
<span class="go">&#39;(w:=2) + (x:=3) * (y:=4) ** (z:=3) == 194&#39;</span>
</pre></div>
</div>
<p>In a more realistic situation, you’d want to have more control over this value
transformation.</p>
<p>Say you wanted to convert to int if it’s possible, try float if not,
and just leave the string alone otherwise.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_try_casting_to_numeric</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">x</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">cast_numbers</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">_try_casting_to_numeric</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cli_f</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">Ingress</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">kwargs_trans</span><span class="o">=</span><span class="n">cast_numbers</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cli_f</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3.14&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">)</span>
<span class="go">&#39;(w:=2) + (x:=3.14) * (y:=4) ** (z:=3) == 202.96&#39;</span>
</pre></div>
</div>
<p>Let’s say that our values transformations are not all 1-to-1 as in the examples
above.
Instead, they can be</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1-to-many</span></code> (e.g. the outer ‘w’ is used to compute the inner <code class="docutils literal notranslate"><span class="pre">w</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">many-to-1</span> <span class="pre">(e.g.</span> <span class="pre">the</span> <span class="pre">outer</span> <span class="pre">``x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are used to compute inner <code class="docutils literal notranslate"><span class="pre">y</span></code>)</p></li>
</ul>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">kwargs_trans</span><span class="p">(</span><span class="n">outer_kw</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>        <span class="c1"># e.g. 1-to-many: one outer arg (w) producing two inner args (w, and y)</span>
<span class="gp">... </span>        <span class="n">w</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">x</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>        <span class="c1"># e.g. many-to-1: two outer args (x and y) producing one inner arg (y)</span>
<span class="gp">... </span>        <span class="n">y</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># Note that no z is mentioned: This means we&#39;re just leaving it alone</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span> <span class="o">=</span> <span class="n">Ingress</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">kwargs_trans</span><span class="o">=</span><span class="n">kwargs_trans</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">ingress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">4</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_f</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ingress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;(w:=4) + (x:=6) * (y:=7) ** (z:=3) == 2062&#39;</span>
</pre></div>
</div>
<p>The following is an example that involves several aspects of the <code class="docutils literal notranslate"><span class="pre">Ingress</span></code> class.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2</span> <span class="kn">import</span> <span class="n">Sig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">kwargs_trans</span><span class="p">(</span><span class="n">outer_kw</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">w</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">x</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>        <span class="c1"># need to pop you (inner func has no you argument)</span>
<span class="gp">... </span>        <span class="n">y</span><span class="o">=</span><span class="n">outer_kw</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">outer_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;you&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="c1"># Note that no z is mentioned: This means we&#39;re just leaving it alone</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span> <span class="o">=</span> <span class="n">Ingress</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">inner_sig</span><span class="o">=</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">kwargs_trans</span><span class="o">=</span><span class="n">kwargs_trans</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">outer_sig</span><span class="o">=</span><span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">ch_names</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;you&#39;</span><span class="p">)</span>  <span class="c1"># need to give the outer sig a you</span>
<span class="gp">... </span>    <span class="c1"># You could also express it this way (though you&#39;d lose the annotations)</span>
<span class="gp">... </span>    <span class="c1"># outer_sig=lambda w, /, x, you=2, *, z=3: None</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">ingress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">you</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">4</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_f</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ingress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">you</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;(w:=4) + (x:=6) * (y:=7) ** (z:=3) == 2062&#39;</span>
</pre></div>
</div>
<p>A convenience method allows to do the same with the ingress instance itself:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_f</span> <span class="o">=</span> <span class="n">ingress</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">you</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;(w:=4) + (x:=6) * (y:=7) ** (z:=3) == 2062&#39;</span>
</pre></div>
</div>
<dl class="py method">
<dt id="i2.wrapper.Ingress.name_map">
<em class="property">classmethod </em><code class="sig-name descname">name_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wrapped</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">old_to_new_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#Ingress.name_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.Ingress.name_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Change argument names.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(w:=</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">) + (x:=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">) * (y:=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">) ** (z:=</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">) == </span><span class="si">{</span><span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span> <span class="o">=</span> <span class="n">Ingress</span><span class="o">.</span><span class="n">name_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="s1">&#39;DoubleYou&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="s1">&#39;Zee&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span>
<span class="go">Ingress signature: (DoubleYou, /, x: float, y=2, *, Zee: int = 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_f</span> <span class="o">=</span> <span class="n">ingress</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">Zee</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">&#39;(w:=1) + (x:=2) * (y:=3) ** (z:=4) == 163&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="i2.wrapper.Ingress.wrap">
<code class="sig-name descname">wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span></em>, <em class="sig-param"><span class="n">egress</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#i2.wrapper.Wrap" title="i2.wrapper.Wrap">i2.wrapper.Wrap</a><a class="reference internal" href="../../_modules/i2/wrapper.html#Ingress.wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.Ingress.wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience method to wrap a function with the instance ingress.
<code class="docutils literal notranslate"><span class="pre">ingress.wrap(func,...)</span></code> equivalent to <code class="docutils literal notranslate"><span class="pre">Wrap(func,</span> <span class="pre">ingress,</span> <span class="pre">...)</span></code></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="i2.wrapper.InnerMapIngress">
<em class="property">class </em><code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">InnerMapIngress</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner_sig</span></em>, <em class="sig-param"><span class="n">kwargs_trans</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>dict<span class="p">]</span><span class="p">, </span>dict<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">_allow_reordering</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">changes_for_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#InnerMapIngress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.InnerMapIngress" title="Permalink to this definition">¶</a></dt>
<dd><p>A class to help build ingresses systematically by mapping the inner signature.</p>
<p><em>Systematically</em>, i.e. “according to a fixed plan/system” is what it’s about here.
As we’ll see below, if you need to write a particular adapter for a specific case,
you probably should do by writing an actual ingress function directly.
In cases where you might want to apply a same logic to wrap many functions,
you may want to fix that wrapping logic: <code class="docutils literal notranslate"><span class="pre">InnerMapIngress</span></code> provides one
way to do this.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inner_sig</strong> – The signature of the wrapped function.</p></li>
<li><p><strong>kwargs_trans</strong> – A dict-to-dict transformation of the outer kwargs to
the kwargs that should be input to the inner function.
That is <code class="docutils literal notranslate"><span class="pre">kwargs_trans</span></code> is <code class="docutils literal notranslate"><span class="pre">outer_kwargs</span> <span class="pre">-&gt;</span> <span class="pre">inner_kwargs</span></code>.
Note that though both outer and inner signatures could have those annoying
position-only kinds, you don’t have to think of that.
The parameter kind restrictions are taken care of automatically.</p></li>
<li><p><strong>_allow_reordering</strong> – Whether we want to allow reordering of variables</p></li>
<li><p><strong>in_to_out_sig_changes</strong> – The <code class="docutils literal notranslate"><span class="pre">inner_name=dict_of_changes_for_that_name</span></code></p></li>
</ul>
</dd>
</dl>
<p>pairs, the <code class="docutils literal notranslate"><span class="pre">dict_of_changes_for_that_name</span></code> is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> with keys being valid
<code class="docutils literal notranslate"><span class="pre">inspect.Parameter</span></code></p>
<p>Consider the following function that has a position only, a keyword only,
two arguments with annotations, and three with a default.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
</pre></div>
</div>
<p>Say we wanted a version of this function</p>
<ul class="simple">
<li><p>that didn’t have the argument kind restrinctions (all POSITION_OR_KEYWORD),</p></li>
<li><p>where the annotation of <code class="docutils literal notranslate"><span class="pre">x</span></code> was changed <code class="docutils literal notranslate"><span class="pre">int</span></code> and the default removed</p></li>
<li><p>where <code class="docutils literal notranslate"><span class="pre">y</span></code> was named <code class="docutils literal notranslate"><span class="pre">you</span></code> instead, and has an annotation (<code class="docutils literal notranslate"><span class="pre">int</span></code>).</p></li>
<li><p>where the default of <code class="docutils literal notranslate"><span class="pre">z</span></code> was <code class="docutils literal notranslate"><span class="pre">10</span></code> instead of <code class="docutils literal notranslate"><span class="pre">3</span></code>, and doesn’t have an</p></li>
</ul>
<p>annotation.</p>
<p>In order to get a version of this function we wanted (more lenient kinds,
with some annotations and a default change), we can use the ingress function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">directly_defined_ingress</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">you</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">you</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>When we need to wrap a specific function in a specific way, defining an
ingress function  this way is usually the simplest way.
But in some cases we need to build the ingress function using some predefined
rule/protocol to make applying the rule/protocol systematic.</p>
<p>For those cases, <code class="docutils literal notranslate"><span class="pre">InnerMapIngress</span></code> comes in handy.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">InnerMapIngress</span></code> we’d build our ingress function like this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PK</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">empty</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span> <span class="o">=</span> <span class="n">InnerMapIngress</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">f</span><span class="p">,</span>
<span class="gp">... </span>    <span class="c1"># change kind to PK:</span>
<span class="gp">... </span>    <span class="n">w</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">PK</span><span class="p">),</span>
<span class="gp">... </span>    <span class="c1"># change annotation of x from float to int and remove default</span>
<span class="gp">... </span>    <span class="n">x</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">empty</span><span class="p">),</span>
<span class="gp">... </span>    <span class="c1"># rename y to you and add annotation int:</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
<span class="gp">... </span>    <span class="c1"># change kind to PK, default to 10, and remove annotation:</span>
<span class="gp">... </span>    <span class="n">z</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">PK</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">empty</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Note:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Only the changes we wish to make to the parameters are mentioned.</dt><dd><p>You could also define the parameters explicitly by simply listing all three
of the dimensions (kind, annotation, and default)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Three? But a <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> object has four; what about the name?</dt><dd><p>Indeed, you can use name as well, more on that later.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Note that in order to specify that you want no default, or no annotation,</dt><dd><p>you cannot use <code class="docutils literal notranslate"><span class="pre">None</span></code> since <code class="docutils literal notranslate"><span class="pre">None</span></code> is both a valid default and a valid
annotation; So instead you need to use <code class="docutils literal notranslate"><span class="pre">Parameter.empty</span></code> (conveniently
assigned to a constant named <code class="docutils literal notranslate"><span class="pre">empty</span></code> in the <code class="docutils literal notranslate"><span class="pre">wrapping</span></code> module.</p>
</dd>
</dl>
</li>
</ul>
<p>Now see that all arguments are <code class="docutils literal notranslate"><span class="pre">POSITIONAL_OR_KEYWORD</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are
<code class="docutils literal notranslate"><span class="pre">int</span></code>, and default of <code class="docutils literal notranslate"><span class="pre">z</span></code> is 10:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">ingress</span><span class="p">))</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">directly_defined_ingress</span><span class="p">))</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="s1">&#39;(w, x: int, you: int = 2, z=10)&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally, <code class="docutils literal notranslate"><span class="pre">ingress</span></code> function does it’s job of dispatching the right args
and kwargs to the target function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">ingress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="n">directly_defined_ingress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt id="i2.wrapper.InnerMapIngress.from_signature">
<em class="property">classmethod </em><code class="sig-name descname">from_signature</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner_sig</span></em>, <em class="sig-param"><span class="n">outer_sig</span></em>, <em class="sig-param"><span class="n">_allow_reordering</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#InnerMapIngress.from_signature"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.InnerMapIngress.from_signature" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inner_sig</strong> – </p></li>
<li><p><strong>outer_sig</strong> – </p></li>
<li><p><strong>_allow_reordering</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<p>Say we wanted to get a version of the function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
</pre></div>
</div>
<p>That was equivalent to (note the kind, default and annotation differences):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ingress</span> <span class="o">=</span> <span class="n">InnerMapIngress</span><span class="o">.</span><span class="n">from_signature</span><span class="p">(</span>
<span class="gp">... </span><span class="n">f</span><span class="p">,</span> <span class="n">outer_sig</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">10</span><span class="p">:</span> <span class="kc">None</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">(</span><span class="n">ingress</span><span class="p">)</span>
<span class="go">&lt;Sig (w, x=1, y=2, z=10)&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">InnerMapIngress</span><span class="o">.</span><span class="n">from_signature</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">g</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1024</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2049</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">h</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">**</span> <span class="mi">4</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="i2.wrapper.MakeFromFunc">
<em class="property">class </em><code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">MakeFromFunc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func_to_obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#MakeFromFunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.MakeFromFunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to indicate that an object should be made as a function of an input func</p>
</dd></dl>

<dl class="py class">
<dt id="i2.wrapper.Wrap">
<em class="property">class </em><code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">Wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">ingress</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">egress</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#Wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.Wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>A function wrapper with interface modifiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – The wrapped function</p></li>
<li><p><strong>ingress</strong> – The incoming data transformer. It determines the argument properties
(name, kind, default and annotation) as well as the actual input of the
wrapped function.</p></li>
<li><p><strong>egress</strong> – The outgoing data transformer. It also takes precedence over the
wrapped function to determine the return annotation of the <code class="docutils literal notranslate"><span class="pre">Wrap</span></code> instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A callable instance wrapping <code class="docutils literal notranslate"><span class="pre">func</span></code></p>
</dd>
</dl>
<p>Some examples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2</span> <span class="kn">import</span> <span class="n">Sig</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>  <span class="c1"># no transformations: wrapped_func is the same as func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;HiHi&#39;</span>
</pre></div>
</div>
<p>Modifying the first argument</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">ingress</span><span class="p">)</span>  <span class="c1"># first variable is now multiplied by 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="go">&#39;HiHiHiHi&#39;</span>
</pre></div>
</div>
<p>Same using keyword args, we need to use tuple to represent an empty tuple</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span> <span class="c1"># Note that b MUST be present as well, or an error will be raised</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">ingress</span><span class="p">)</span>  <span class="c1"># first variable is now multiplied by 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="go">&#39;HiHiHiHi&#39;</span>
</pre></div>
</div>
<p>Using both args and kwargs</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">ingress</span><span class="p">)</span>  <span class="c1"># first variable is now multiplied by 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="go">&#39;HiHiHiHi&#39;</span>
</pre></div>
</div>
<p>We can use ingress to ADD parameters to func</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">),</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">ingress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now wrapped_func takes three arguments</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="s1">&#39;world!&#39;</span><span class="p">)</span>
<span class="go">&#39;Hiworld!Hiworld!&#39;</span>
</pre></div>
</div>
<p>Egress is a bit more straightforward, it simply applies to the output of the
wrapped function. We can use ingress to ADD parameters to func</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">egress</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">output</span> <span class="o">+</span> <span class="s1">&#39; ITSME!!!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="o">=</span><span class="n">ingress</span><span class="p">,</span> <span class="n">egress</span><span class="o">=</span><span class="n">egress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now wrapped_func takes three arguments</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="s1">&#39;world!&#39;</span><span class="p">)</span>
<span class="go">&#39;Hiworld!Hiworld! ITSME!!!&#39;</span>
</pre></div>
</div>
<p>A more involved example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;hi&quot;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">times</span> <span class="o">*</span> <span class="n">string</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;world! &quot;</span><span class="p">,</span> <span class="s2">&quot;Hi&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Hi world! Hi world! Hi world! &quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">egress</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;co&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;coco&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;co&quot;</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ingress</span><span class="p">,</span> <span class="n">egress</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">wrapped_func</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;world! &quot;</span><span class="p">,</span> <span class="s2">&quot;Hi&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="mi">30</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;Hi world! Hi world! Hi world! &quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>An ingress function links the interface of the wrapper to the interface of the
wrapped func; therefore it’s definition often depends on information of both,
and for that reason, we provide the ability to specify the ingress not only
explicitly (as in the examples above), but through a factory – a function that
will be called on <cite>func</cite> to produce the ingress that should be used to wrap it.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="docutils literal notranslate"><span class="pre">wrap</span></code> function.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.append_empty_args">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">append_empty_args</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#append_empty_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.append_empty_args" title="Permalink to this definition">¶</a></dt>
<dd><p>To use to transform an ingress function that only returns kwargs to one that
returns the normal form of ingress functions: ((), kwargs)</p>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.camelize">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">camelize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#camelize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.camelize" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">camelize</span><span class="p">(</span><span class="s1">&#39;camel_case&#39;</span><span class="p">)</span>
<span class="go">&#39;CamelCase&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.func_to_method_func">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">func_to_method_func</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">instance_params</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">method_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">method_params</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">instance_arg_name</span><span class="o">=</span><span class="default_value">'self'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../../_modules/i2/wrapper.html#func_to_method_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.func_to_method_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a ‘method function’ from a ‘normal function’.</p>
<p>That is, get a function that gives the same outputs as the ‘normal function’,
except that some of the arguments are sourced from the attributes of the first
argument.</p>
<p>The intended use case is when you want to inject one or several methods in a class
or instance, sourcing some of the arguments of the underlying function from a
common pool: The attributes of the instance.</p>
<p>Consider the following function involving four parameters: <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">&#39;hello: 9&#39;</span>
</pre></div>
</div>
<p>If we wanted to make an equivalent “method function” that would source it’s <code class="docutils literal notranslate"><span class="pre">a</span></code>
and it’s <code class="docutils literal notranslate"><span class="pre">c</span></code> from the first argument’s (in practice this first argument will be
and instance of the class the method will be bound to), we can do so like so:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">method_func</span> <span class="o">=</span> <span class="n">func_to_method_func</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;a c&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">method_func</span><span class="p">))</span>
<span class="go">&quot;(self, b: int, *, d=&#39;bar&#39;)&quot;</span>
</pre></div>
</div>
<p>Note that the first argument is <code class="docutils literal notranslate"><span class="pre">self</span></code> (default name for an “instance”),
that <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> are not there, but that the two remaining parameters,
<code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> are present, in the same order, and with the same annotations and
parameter kind (the <code class="docutils literal notranslate"><span class="pre">d</span></code> is still keyword-only).</p>
<p>Now let’s make a dummy object that has attributes <code class="docutils literal notranslate"><span class="pre">a</span></code> and a <code class="docutils literal notranslate"><span class="pre">c</span></code>, and use it to
call <code class="docutils literal notranslate"><span class="pre">method_func</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Klass</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">Klass</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">method_func</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">&#39;hello: 9&#39;</span>
</pre></div>
</div>
<p>Which is:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">method_func</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.identity">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">identity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#identity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.identity" title="Permalink to this definition">¶</a></dt>
<dd><p>Transparent function, returning what’s been input</p>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.include_exclude">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">include_exclude</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">include</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">exclude</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#include_exclude"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.include_exclude" title="Permalink to this definition">¶</a></dt>
<dd><p>Reorder and/or remove parameters.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">=}</span><span class="s2">,</span><span class="si">{</span><span class="n">b</span><span class="si">=}</span><span class="s2">,</span><span class="si">{</span><span class="n">c</span><span class="si">=}</span><span class="s2">,</span><span class="si">{</span><span class="n">d</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span> <span class="o">=</span> <span class="n">include_exclude</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="s1">&#39;b a&#39;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;c d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The signature of <code class="docutils literal notranslate"><span class="pre">bar</span></code> has only <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code>, in that order:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">bar</span><span class="p">))</span>
<span class="go">&#39;(b, a)&#39;</span>
</pre></div>
</div>
<p>But the function still works and does the same thing:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="go">a=&#39;A&#39;,b=&#39;B&#39;,c=&#39;C&#39;,d=&#39;D&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.include_exclude_ingress_factory">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">include_exclude_ingress_factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">include</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">exclude</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#include_exclude_ingress_factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.include_exclude_ingress_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>A pattern underlying any ingress that takes a subset of parameters (possibly
reordering them).</p>
<p>For example: Keep only required arguments, or reorder params to be able to
partialize #3 (without having to partialize #1 and #2)</p>
<p>Note: A more general version would allow include and exclude to be expressed as
functions that apply to one or several properties of the params (name, kind, default,
annotation).</p>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.items_with_mapped_keys">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">items_with_mapped_keys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span><span class="p">:</span> <span class="n">dict</span></em>, <em class="sig-param"><span class="n">key_mapper</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#items_with_mapped_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.items_with_mapped_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform dict keys. More precisely yield (new_k,v) pairs from a key mapper dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – src dict</p></li>
<li><p><strong>key_mapper</strong> – {old_name: new_name, …} mapping</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>generator of (new_name, value) pairs</p>
</dd>
</dl>
<p>Often used in conjunction with dict:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">items_with_mapped_keys</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;Ay&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;Dee&#39;</span><span class="p">})</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">{&#39;Ay&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;Dee&#39;: 4}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.make_funcs_binding_class">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">make_funcs_binding_class</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">funcs</span></em>, <em class="sig-param"><span class="n">init_params</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">cls_name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#make_funcs_binding_class"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.make_funcs_binding_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform one or several functions into a class that contains them as methods
sourcing specific arguments from the instance’s attributes.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&#39;bar: 6&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Klass</span> <span class="o">=</span> <span class="n">make_funcs_binding_class</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="s1">&#39;a c&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Klass</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;Foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">Klass</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">instance</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;hello: 9&#39;</span> <span class="o">==</span> <span class="n">foo</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">Klass</span><span class="p">))</span>
<span class="go">&quot;(a: &#39;typing.Any&#39;, c: &#39;typing.Any&#39; = 2) -&gt; None&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">Klass</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
<span class="go">&#39;Foo(a=1, c=3)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">foo</span><span class="p">))</span>
<span class="go">&quot;(b, *, d=&#39;bar&#39;)&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">&#39;hello: 9&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;goodbye&#39;</span><span class="p">)</span>
<span class="go">&#39;goodbye: 33&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.nice_kinds">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">nice_kinds</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#nice_kinds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.nice_kinds" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps the func so it will only have POSITIONAL_OR_KEYWORD argument kinds.</p>
<p>The original purpose of this function is to remove argument-kind restriction
annoyances when doing functional manipulations such as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isinstance_of_str</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">class_or_tuple</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isinstance_of_str</span><span class="p">(</span><span class="s1">&#39;I am a string&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">isinstance() takes no keyword arguments</span>
</pre></div>
</div>
<p>Here, instead, we can just get a kinder version of the function and do what we
want to do:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">_isinstance</span> <span class="o">=</span> <span class="n">nice_kinds</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isinstance_of_str</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_isinstance</span><span class="p">,</span> <span class="n">class_or_tuple</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isinstance_of_str</span><span class="p">(</span><span class="s1">&#39;I am a string&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isinstance_of_str</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.rm_params">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">rm_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">params_to_remove</span><span class="o">=</span><span class="default_value">()</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#rm_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.rm_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a function with some parameters removed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">rm_params</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">params_to_remove</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">&#39;(x, y=1)&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">rm_params</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">params_to_remove</span><span class="o">=</span><span class="s1">&#39;y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">&#39;(x)&#39;</span>
</pre></div>
</div>
<p>But <code class="docutils literal notranslate"><span class="pre">rm_params</span></code> won’t let you remove params that don’t have defaults.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">rm_params</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">params_to_remove</span><span class="o">=</span><span class="s1">&#39;x z&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">AssertionError</span>: <span class="n">Some of the params you want to remove don&#39;t have defaults: {&#39;x&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.transparent_egress">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">transparent_egress</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">output</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#transparent_egress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.transparent_egress" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">transparent_egress</span><span class="p">(</span><span class="s1">&#39;unnecessary_doctest&#39;</span><span class="p">)</span>
<span class="go">&#39;unnecessary_doctest&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.transparent_ingress">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">transparent_ingress</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#transparent_ingress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.transparent_ingress" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">transparent_ingress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">((1, 2), {&#39;test&#39;: 1})</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="i2.wrapper.wrap">
<code class="sig-prename descclassname">i2.wrapper.</code><code class="sig-name descname">wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">ingress</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">egress</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/i2/wrapper.html#wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#i2.wrapper.wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a function, optionally transforming interface, input and output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – The wrapped function</p></li>
<li><p><strong>ingress</strong> – The incoming data transformer. It determines the argument properties
(name, kind, default and annotation) as well as the actual input of the
wrapped function.</p></li>
<li><p><strong>egress</strong> – The outgoing data transformer. It also takes precedence over the
wrapped function to determine the return annotation of the <code class="docutils literal notranslate"><span class="pre">Wrap</span></code> instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A callable instance wrapping <code class="docutils literal notranslate"><span class="pre">func</span></code></p>
</dd>
</dl>
<p>Consider the following function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">17</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span>
</pre></div>
</div>
<p>See that <code class="docutils literal notranslate"><span class="pre">f</span></code> is restricted to use <code class="docutils literal notranslate"><span class="pre">z</span></code> as keyword only argument kind:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">f() takes from 1 to 3 positional arguments but 4 were given</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">w</span></code> has position only argument kind:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">f() got some positional-only arguments passed as keyword arguments: &#39;w&#39;</span>
</pre></div>
</div>
<p>Say we wanted a version of this function that didn’t have the argument kind
restrinctions, where the annotation of <code class="docutils literal notranslate"><span class="pre">x</span></code> was <code class="docutils literal notranslate"><span class="pre">int</span></code> and where the default
of <code class="docutils literal notranslate"><span class="pre">z</span></code> was <code class="docutils literal notranslate"><span class="pre">10</span></code> instead of <code class="docutils literal notranslate"><span class="pre">3</span></code>, and doesn’t have an annotation.
We can do so using the following ingress function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ingress</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>The ingress function serves two purposes:</p>
<ul class="simple">
<li><p>Redefining the signature (i.e. the argument names, kinds, defaults,</p></li>
</ul>
<p>and annotations (not including the return annotation, which is taken care of by the
egress argument).</p>
<ul class="simple">
<li><p>Telling the wrapper how to get from that interface to the interface of the</p></li>
</ul>
<p>wrapped function.</p>
<p>If we also wanted to add a return_annotation, we could do so via an <code class="docutils literal notranslate"><span class="pre">egress</span></code>
function argument:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">egress</span><span class="p">(</span><span class="n">wrapped_func_output</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">wrapped_func_output</span>  <span class="c1"># because here we don&#39;t want to do anything extra</span>
</pre></div>
</div>
<p>Now we can use these ingress and egress functions to get the version of <code class="docutils literal notranslate"><span class="pre">f</span></code> of
our dreams:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ingress</span><span class="p">,</span> <span class="n">egress</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s see what the signature of our new function looks like:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
<span class="go">&#39;(w, x: int = 1, y: int = 2, z=10) -&gt; float&#39;</span>
</pre></div>
</div>
<p>Now let’s see that we can actually use this new function <code class="docutils literal notranslate"><span class="pre">h</span></code>, without the
restrictions of argument kind, getting the same results as the wrapped <code class="docutils literal notranslate"><span class="pre">f</span></code>,
but with default <code class="docutils literal notranslate"><span class="pre">z=10</span></code>.</p>
<p>What we wanted (but couldn’t) do with <code class="docutils literal notranslate"><span class="pre">f</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># == 1 + 2 * 3 ** 4</span>
<span class="go">163</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">163</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">1024</span>
</pre></div>
</div>
<p>For more examples, see also the</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="docutils literal notranslate"><span class="pre">Wrap</span></code> class.</p>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="util.html" class="btn btn-neutral float-left" title="i2.util" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright OtoSense 2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>