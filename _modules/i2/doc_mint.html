

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>i2.doc_mint &mdash; i2 0.1.59 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=755f2e77"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            i2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2.html">i2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/_deprecated.html">i2._deprecated</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/base.html">i2.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/castgraph.html">i2.castgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/chain_map.html">i2.chain_map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/deco.html">i2.deco</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/doc_mint.html">i2.doc_mint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/errors.html">i2.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/examples.html">i2.examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/examples/castgraph_examples.html">i2.examples.castgraph_examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/examples/signature_calculus.html">i2.examples.signature_calculus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/footprints.html">i2.footprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/io_trans.html">i2.io_trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/itypes.html">i2.itypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/key_path.html">i2.key_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/multi_object.html">i2.multi_object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/routing_forest.html">i2.routing_forest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap.html">i2.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/scrap.html">i2.scrap.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/scrap_ch_variadics.html">i2.scrap.scrap_ch_variadics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/scrap_kwargs.html">i2.scrap.scrap_kwargs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/signature_bops.html">i2.scrap.signature_bops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/simple_pymint.html">i2.scrap.simple_pymint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/scrap/switch_case_tree.html">i2.scrap.switch_case_tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/signatures.html">i2.signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests.html">i2.tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/footprints_test.html">i2.tests.footprints_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/objects_for_testing.html">i2.tests.objects_for_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/test_castgraph.html">i2.tests.test_castgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/test_castgraph_kinds.html">i2.tests.test_castgraph_kinds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/test_signatures.html">i2.tests.test_signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/test_util.html">i2.tests.test_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/test_wrapper.html">i2.tests.test_wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/tests/util.html">i2.tests.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/util.html">i2.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/i2/wrapper.html">i2.wrapper</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">i2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">i2.doc_mint</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for i2.doc_mint</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Meta-interfaces&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>

<span class="n">nan</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

<span class="c1"># --------------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="find_in_params">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.find_in_params">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_in_params</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">search_in</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find parameters in a list of parameter specifications.</span>

<span class="sd">    :param query: The query to search for.</span>
<span class="sd">    :param params: The list of parameter specifications.</span>
<span class="sd">        Params can be provided in two formats:</span>
<span class="sd">        - A function, from which the params will be extracted from the docstring.</span>
<span class="sd">        - A list of dictionaries where each dictionary specifies a parameter, containing:</span>
<span class="sd">            - name: The name of the parameter (str).</span>
<span class="sd">            - default: The default value of the parameter (any, optional).</span>
<span class="sd">            - annotation: The type annotation for the parameter (str, optional).</span>
<span class="sd">            - description: A description of the parameter (str).</span>
<span class="sd">        If a callable is provided, it will be used to generate the list of parameter specifications.</span>
<span class="sd">    :param search_in: The fields to search in each parameter specification.</span>
<span class="sd">    :return: A list of parameter specifications that match the query.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; params = [</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;x&quot;, &quot;default&quot;: 1, &quot;annotation&quot;: &quot;int&quot;, &quot;description&quot;: &quot;An integer value.&quot;},</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;y&quot;, &quot;default&quot;: None, &quot;annotation&quot;: &quot;str&quot;, &quot;description&quot;: &quot;An optional string.&quot;},</span>
<span class="sd">    ... ]</span>
<span class="sd">    &gt;&gt;&gt; find_in_params(&#39;int&#39;, params)</span>
<span class="sd">    [{&#39;name&#39;: &#39;x&#39;, &#39;default&#39;: 1, &#39;annotation&#39;: &#39;int&#39;, &#39;description&#39;: &#39;An integer value.&#39;}]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_in</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">search_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">search_in</span><span class="p">,)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">docstring_to_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">search_in</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="indent_lines">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.indent_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">indent_lines</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Indent each line of a string.</span>

<span class="sd">    :param string: The string to indent.</span>
<span class="sd">    :param indent: The string to use for indentation.</span>
<span class="sd">    :return: The indented string.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; print(indent_lines(&#39;This is a test.\nAnother line.&#39;, &#39; &#39; * 8))</span>
<span class="sd">            This is a test.</span>
<span class="sd">            Another line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span></div>



<div class="viewcode-block" id="most_common_indent">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.most_common_indent">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">most_common_indent</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ignore_first_line</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the most common indentation in a string.</span>

<span class="sd">    :param string: The string to analyze.</span>
<span class="sd">    :param ignore_first_line: Whether to ignore the first line when determining the</span>
<span class="sd">        indentation. Default is True since the first line often has no indentation</span>
<span class="sd">        because of the way python strings appear in code.</span>
<span class="sd">    :return: The most common indentation string.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; most_common_indent(&#39;    This is a test.\n    Another line.&#39;)</span>
<span class="sd">    &#39;    &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^( *)\S&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">n_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indents</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ignore_first_line</span> <span class="ow">and</span> <span class="n">n_lines</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># if there&#39;s more than one line, ignore the indent of the first</span>
        <span class="c1"># (This is is because of the way docstrings are often formatted)</span>
        <span class="n">indents</span> <span class="o">=</span> <span class="n">indents</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">indents</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">indents</span><span class="o">.</span><span class="n">count</span><span class="p">)</span></div>



<div class="viewcode-block" id="inject_docstring_content">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.inject_docstring_content">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inject_docstring_content</span><span class="p">(</span><span class="n">to_inject</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">position</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject content into the docstring of a function.</span>

<span class="sd">    Note: If you use the decorator on a string, it will assume that string is the doc</span>
<span class="sd">    string you want to transform and return the modified string directly.</span>

<span class="sd">    :param to_inject: The content to inject.</span>
<span class="sd">    :param position: The position in the docstring to inject the content.</span>
<span class="sd">        If an integer, the content is injected at that line number (pushing the rest down).</span>
<span class="sd">        If a string, will consider it as a regex pattern to match the line to inject after.</span>
<span class="sd">        Default is -1, to inject at the end.</span>
<span class="sd">    :param indent: Control on indent.</span>
<span class="sd">        If True, will use the most common indent of the input docstrings.</span>
<span class="sd">        If a string, it will use that specific string.</span>
<span class="sd">    :return: A decorator that injects the content into the docstring of the decorated function.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; @inject_docstring_content(&#39;This is a test.&#39;)</span>
<span class="sd">    ... def test_func():</span>
<span class="sd">    ...     &#39;&#39;&#39;This is the docstring.&#39;&#39;&#39;</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; test_func.__doc__</span>
<span class="sd">    &#39;This is the docstring.\nThis is a test.&#39;</span>
<span class="sd">    &gt;&gt;&gt; @inject_docstring_content(&#39;This is a test.&#39;, position=&#39;###INSERT HERE###&#39;)</span>
<span class="sd">    ... def test_func():</span>
<span class="sd">    ...     &#39;&#39;&#39;This is the docstring.</span>
<span class="sd">    ...     ###INSERT HERE###</span>
<span class="sd">    ...     More blah.</span>
<span class="sd">    ...     &#39;&#39;&#39;</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; test_func.__doc__</span>
<span class="sd">    &#39;This is the docstring.\n    ###INSERT HERE###\n    More blah.\n    &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">indent</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">most_common_indent</span><span class="p">(</span><span class="n">to_inject</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">input_was_docstr_itself</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">func</span>
            <span class="n">input_was_docstr_itself</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: Could figure out indent (ignoring first line), to inform the injected content indent</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_inject</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">to_inject</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">to_inject</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="n">new_doc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_was_docstr_itself</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_doc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">new_doc</span>
            <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span></div>



<span class="c1"># TODO: params_to_docstring and docstring_to_params are a parse/generate pair, with echoes of embody and routing techniques.</span>
<div class="viewcode-block" id="params_to_docstring">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.params_to_docstring">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">params_to_docstring</span><span class="p">(</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">doc_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="n">take_name_of_types</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">quote_string_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a docstring from a list of parameter specifications.</span>

<span class="sd">    :param params: A list of dictionaries where each dictionary specifies a parameter.</span>
<span class="sd">        Each dictionary should contain:</span>
<span class="sd">          - name: The name of the parameter (str).</span>
<span class="sd">          - default: The default value of the parameter (any, optional).</span>
<span class="sd">          - annotation: The type annotation for the parameter (str, optional).</span>
<span class="sd">          - description: A description of the parameter (str).</span>
<span class="sd">    :param doc_style: The style of the docstring to generate. One of &#39;numpy&#39;, &#39;google&#39;, or &#39;rest&#39;.</span>
<span class="sd">    :param take_name_of_types: Whether to use the name of the type as the annotation (bool).</span>
<span class="sd">    :param quote_string_defaults: Whether to quote string defaults (bool).</span>

<span class="sd">    :return: A formatted docstring (str).</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; params = [</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;x&quot;, &quot;default&quot;: 1, &quot;annotation&quot;: &quot;int&quot;, &quot;description&quot;: &quot;An integer value.&quot;},</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;y&quot;, &quot;default&quot;: None, &quot;annotation&quot;: &quot;str&quot;, &quot;description&quot;: &quot;An optional string.&quot;},</span>
<span class="sd">    ... ]</span>
<span class="sd">    &gt;&gt;&gt; print(params_to_docstring(params))  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : int, default=1</span>
<span class="sd">        An integer value.</span>
<span class="sd">    y : str, default=None</span>
<span class="sd">        An optional string.</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; print(params_to_docstring(params, doc_style=&#39;google&#39;))  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    Args:</span>
<span class="sd">        x (int, optional): An integer value. Defaults to 1.</span>
<span class="sd">        y (str, optional): An optional string. Defaults to None.</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; print(params_to_docstring(params, doc_style=&#39;rest&#39;))  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    :param x: An integer value. (Default: 1)</span>
<span class="sd">    :type x: int</span>
<span class="sd">    :param y: An optional string. (Default: None)</span>
<span class="sd">    :type y: str</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Preprocess parameters to a uniform structure</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">processed_params</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">take_name_of_types</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">description</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>  <span class="c1"># float to catch nans</span>
                <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">quote_string_defaults</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">default</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="n">optional</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">p</span>

            <span class="k">yield</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">default</span><span class="p">,</span>
                <span class="s2">&quot;optional&quot;</span><span class="p">:</span> <span class="n">optional</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">numpy_lines</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s2">&quot;Parameters&quot;</span>
        <span class="k">yield</span> <span class="s2">&quot;----------&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; : </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, default=</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">yield</span> <span class="n">line</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">google_lines</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s2">&quot;Args:&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;, optional&quot;</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
            <span class="k">elif</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot; (optional)&quot;</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]:</span>
                <span class="n">desc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Defaults to </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">yield</span> <span class="n">line</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rest_lines</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]:</span>
                <span class="n">desc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (Default: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;:param </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;:type </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;numpy&quot;</span><span class="p">:</span> <span class="n">numpy_lines</span><span class="p">,</span>
        <span class="s2">&quot;google&quot;</span><span class="p">:</span> <span class="n">google_lines</span><span class="p">,</span>
        <span class="s2">&quot;rest&quot;</span><span class="p">:</span> <span class="n">rest_lines</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">doc_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported doc_style: </span><span class="si">{</span><span class="n">doc_style</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="n">formatters</span><span class="p">[</span><span class="n">doc_style</span><span class="p">](</span><span class="n">processed_params</span><span class="p">())</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="string_param_to_obj">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.string_param_to_obj">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">string_param_to_obj</span><span class="p">(</span><span class="n">string_to_object_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string representation of a parameter to an object.</span>

<span class="sd">    Use Case: When parsing a docstring, you get values as strings, but these values</span>
<span class="sd">    may need to be converted to their actual object types</span>
<span class="sd">    (in the case of default and annotatios for example).</span>
<span class="sd">    This is a helper function to do that conversion.</span>

<span class="sd">    :param string: The string representation of the parameter.</span>
<span class="sd">    :param string_to_object_mapping: A mapping from string representations to objects.</span>
<span class="sd">    :return: The object corresponding to the string representation.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; string_to_object_mapping = {</span>
<span class="sd">    ...     &#39;None&#39;: None,</span>
<span class="sd">    ...     &#39;list&#39;: list,</span>
<span class="sd">    ...     &#39;int&#39;: int,</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; string_to_obj = string_param_to_obj(string_to_object_mapping)</span>
<span class="sd">    &gt;&gt;&gt; string_to_obj(&#39;None&#39;)</span>
<span class="sd">    &gt;&gt;&gt; string_to_obj(&#39;list&#39;)</span>
<span class="sd">    &lt;class &#39;list&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; string_to_obj(&#39;int&#39;)</span>
<span class="sd">    &lt;class &#39;int&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; string_to_obj(&#39;not something listed&#39;)</span>
<span class="sd">    &#39;not something listed&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">string_param_to_obj</span><span class="p">,</span> <span class="n">string_to_object_mapping</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_to_object_mapping</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string_to_object_mapping</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO: Should handle strings that are numeric values...</span>

        <span class="c1"># if all else fails, return the string itself</span>
        <span class="k">return</span> <span class="n">string</span></div>



<span class="n">dflt_str_to_obj_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;True&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;False&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;list&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="s2">&quot;tuple&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
    <span class="s2">&quot;set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span>
    <span class="s2">&quot;bool&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="s2">&quot;complex&quot;</span><span class="p">:</span> <span class="nb">complex</span><span class="p">,</span>
    <span class="s2">&quot;nan&quot;</span><span class="p">:</span> <span class="n">nan</span><span class="p">,</span>
    <span class="s2">&quot;inf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;-inf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">_MAX_LENGTH_FOR_LITERAL_EVAL</span> <span class="o">=</span> <span class="mi">1000</span>


<span class="k">def</span><span class="w"> </span><span class="nf">literal_eval_converter</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">_MAX_LENGTH_FOR_LITERAL_EVAL</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>  <span class="c1"># Restrict long strings for extra safety</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># extra safety</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>


<div class="viewcode-block" id="register_converter">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.register_converter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">register_converter</span><span class="p">(</span><span class="n">converter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a new converter. A converter can be:</span>
<span class="sd">      - A dict: { &quot;None&quot;: None, &quot;int&quot;: int, ... }</span>
<span class="sd">      - A callable: lambda s: attempt to parse s and return object or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dflt_str_to_obj_converters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span></div>



<span class="n">dflt_str_to_obj_converters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">register_converter</span><span class="p">(</span><span class="n">dflt_str_to_obj_mapping</span><span class="p">)</span>
<span class="n">register_converter</span><span class="p">(</span><span class="n">literal_eval_converter</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">convert_string</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">converters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">converters</span><span class="p">:</span>
        <span class="c1"># If converter is a dict</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">converter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">converter</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">converter</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

        <span class="c1"># If converter is a callable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># If a callable fails, just skip it</span>
                <span class="k">pass</span>

    <span class="c1"># If no converter matched</span>
    <span class="k">return</span> <span class="n">s</span>


<div class="viewcode-block" id="docstring_to_params">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.docstring_to_params">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">docstring_to_params</span><span class="p">(</span>
    <span class="n">docstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">doc_style</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s2">&quot;google&quot;</span><span class="p">,</span> <span class="s2">&quot;rest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
    <span class="n">converters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">dflt_str_to_obj_converters</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a docstring and extract parameter specifications.</span>

<span class="sd">    :param docstring: The docstring to parse.</span>
<span class="sd">    :param doc_style: The style of the docstring to parse. One of &#39;numpy&#39;, &#39;google&#39;, or &#39;rest&#39;.</span>

<span class="sd">    :return: A list of parameter specifications, where each specification is a dictionary containing:</span>
<span class="sd">        - name: The name of the parameter (str).</span>
<span class="sd">        - default: The default value of the parameter (str, optional).</span>
<span class="sd">        - annotation: The type annotation for the parameter (str, optional).</span>
<span class="sd">        - description: A description of the parameter (str).</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; docstring = &#39;&#39;&#39;</span>
<span class="sd">    ... Parameters</span>
<span class="sd">    ... ----------</span>
<span class="sd">    ... x : int, default=1</span>
<span class="sd">    ...     An integer value.</span>
<span class="sd">    ... y : str, default=None</span>
<span class="sd">    ...     An optional string.</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; params = docstring_to_params(docstring)</span>
<span class="sd">    &gt;&gt;&gt; params  == [</span>
<span class="sd">    ...     {&#39;name&#39;: &#39;x&#39;, &#39;default&#39;: 1, &#39;annotation&#39;: int, &#39;description&#39;: &#39;An integer value.&#39;},</span>
<span class="sd">    ...     {&#39;name&#39;: &#39;y&#39;, &#39;default&#39;: None, &#39;annotation&#39;: str, &#39;description&#39;: &#39;An optional string.&#39;}</span>
<span class="sd">    ... ]</span>
<span class="sd">    True</span>


<span class="sd">    &gt;&gt;&gt; docstring = &#39;&#39;&#39;</span>
<span class="sd">    ... Args:</span>
<span class="sd">    ...     x (int, optional): An integer value. Defaults to 1.</span>
<span class="sd">    ...     y (str, optional): An optional string. Defaults to None.</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; params = docstring_to_params(docstring, doc_style=&#39;google&#39;)</span>
<span class="sd">    &gt;&gt;&gt; params == [</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;x&quot;, &quot;default&quot;: 1, &quot;annotation&quot;: int, &quot;description&quot;: &quot;An integer value.&quot;},</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;y&quot;, &quot;default&quot;: None, &quot;annotation&quot;: str, &quot;description&quot;: &quot;An optional string.&quot;},</span>
<span class="sd">    ... ]</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; docstring = &#39;&#39;&#39;</span>
<span class="sd">    ... :param x: An integer value. (Default: 1)</span>
<span class="sd">    ... :type x: int</span>
<span class="sd">    ... :param y: An optional string. (Default: None)</span>
<span class="sd">    ... :type y: str</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; params = docstring_to_params(docstring, doc_style=&#39;rest&#39;)</span>
<span class="sd">    &gt;&gt;&gt; params == [</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;x&quot;, &quot;default&quot;: 1, &quot;annotation&quot;: int, &quot;description&quot;: &quot;An integer value.&quot;},</span>
<span class="sd">    ...     {&quot;name&quot;: &quot;y&quot;, &quot;default&quot;: None, &quot;annotation&quot;: str, &quot;description&quot;: &quot;An optional string.&quot;},</span>
<span class="sd">    ... ]</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docstring</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">docstring</span><span class="p">):</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract parameter lines</span>
    <span class="n">param_lines</span> <span class="o">=</span> <span class="n">_extract_params_section</span><span class="p">(</span><span class="n">docstring</span><span class="p">,</span> <span class="n">doc_style</span><span class="p">)</span>

    <span class="c1"># Parse parameter lines</span>
    <span class="k">if</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_parse_numpy_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_parse_google_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;rest&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_parse_rest_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported doc_style: </span><span class="si">{</span><span class="n">doc_style</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_string</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">converters</span><span class="p">)</span>
        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_string</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">],</span> <span class="n">converters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">param</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">convert_param</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">params</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_extract_params_section</span><span class="p">(</span><span class="n">docstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">doc_style</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">docstring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
        <span class="c1"># Find &quot;Parameters&quot; section</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">param_index</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Parameters&quot;</span><span class="p">)</span>
            <span class="c1"># Next line should be a separator like &#39;----------&#39;</span>
            <span class="n">separator_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">param_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;-{3,}&quot;</span><span class="p">,</span> <span class="n">separator_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Expected a separator after &#39;Parameters&#39; in Numpy docstring&quot;</span>
                <span class="p">)</span>
            <span class="n">param_lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">param_index</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># &quot;Parameters&quot; section not found</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
        <span class="c1"># Find &quot;Args:&quot; section</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">param_index</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Args:&quot;</span><span class="p">)</span>
            <span class="n">param_lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">param_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># &quot;Args:&quot; section not found</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">doc_style</span> <span class="o">==</span> <span class="s2">&quot;rest&quot;</span><span class="p">:</span>
        <span class="n">param_lines</span> <span class="o">=</span> <span class="n">lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported doc_style: </span><span class="si">{</span><span class="n">doc_style</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">param_lines</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_collect_indented_lines</span><span class="p">(</span>
    <span class="n">param_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">start_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent_level</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">description_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">start_index</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_lines</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent_level</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
    <span class="p">):</span>
        <span class="n">description_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">description_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">i</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_parse_numpy_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_lines</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="c1"># Match parameter line: name : type, default=value</span>
        <span class="n">param_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^(\w+)\s*:\s*([^,]+)(?:,\s*default=(.+))?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">param_match</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Collect description lines</span>
            <span class="n">description</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">_collect_indented_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">default</span><span class="p">,</span>
                <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_parse_google_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_lines</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="c1"># Match parameter line: name (type, optional): description</span>
        <span class="n">param_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^ </span><span class="si">{4}</span><span class="s2">(\w+)\s*(?:\(([^)]+)\))?:\s*(.+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param_match</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">type_default</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">type_default</span><span class="p">:</span>
                <span class="c1"># Parse type and optional</span>
                <span class="n">type_parts</span> <span class="o">=</span> <span class="n">type_default</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">type_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">type_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]:</span>
                    <span class="c1"># Extract default from description if present</span>
                    <span class="n">default_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Defaults to (.+)\.&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">default_match</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">default_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">description</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                            <span class="sa">r</span><span class="s2">&quot;Defaults to .+\.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">description</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Collect additional description lines</span>
            <span class="n">extra_description</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">_collect_indented_lines</span><span class="p">(</span>
                <span class="n">param_lines</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="mi">8</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">extra_description</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">extra_description</span>
            <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">default</span><span class="p">,</span>
                <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="p">}</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_parse_rest_param_lines</span><span class="p">(</span><span class="n">param_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
    <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_lines</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">param_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Match &#39;:param name: description&#39;</span>
        <span class="n">param_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^:param (\w+):\s*(.+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param_match</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">param_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Check for default value in description</span>
            <span class="n">default_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(Default:\s*(.+)\)&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">default_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">default_match</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(Default:\s*.+\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Initialize parameter entry</span>
            <span class="n">params_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">default</span><span class="p">,</span>
                <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Match &#39;:type name: type&#39;</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;:type&quot;</span><span class="p">):</span>
            <span class="n">type_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^:type (\w+):\s*(.+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">type_match</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">type_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">params_dict</span><span class="p">:</span>
                    <span class="n">params_dict</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;annotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Type without param, create entry</span>
                    <span class="n">params_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">params_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="c1"># --------------------------------------------------------------------------------------</span>
<span class="c1"># Older stuff. TODO: Clean up and remove what&#39;s not needed</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">doctest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">inspect</span><span class="w"> </span><span class="kn">import</span> <span class="n">getdoc</span>

<span class="n">MAX_LINE_LENGTH</span> <span class="o">=</span> <span class="mi">72</span>  <span class="c1"># https://en.wikipedia.org/wiki/Characters_per_line</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_prefix_lines</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;# &quot;</span><span class="p">,</span> <span class="n">even_if_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prefix every line of s with given prefix.</span>

<span class="sd">    :param s: String whose lines you want to prefix.</span>
<span class="sd">    :param prefix: Desired prefix string. Default is &#39;# &#39;, to have the effect of &quot;commenting out&quot; line</span>
<span class="sd">    :param even_if_empty: Whether to prefix empty strings or not.</span>
<span class="sd">    :return: A string whose lines have been prefixed.</span>

<span class="sd">    &gt;&gt;&gt; _prefix_lines(&#39;something to comment out&#39;)</span>
<span class="sd">    &#39;# something to comment out&#39;</span>
<span class="sd">    &gt;&gt;&gt; _prefix_lines(&#39;A line you want to prefix&#39;, prefix=&#39;PREFIX: &#39;)</span>
<span class="sd">    &#39;PREFIX: A line you want to prefix&#39;</span>
<span class="sd">    &gt;&gt;&gt; print(_prefix_lines(&#39;What happens\nif the thing to comment out\nhas multiple lines?&#39;))</span>
<span class="sd">    # What happens</span>
<span class="sd">    # if the thing to comment out</span>
<span class="sd">    # has multiple lines?</span>
<span class="sd">    &gt;&gt;&gt; _prefix_lines(&#39;&#39;)  # see that an empty string is returned as is</span>
<span class="sd">    &#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; _prefix_lines(&#39;&#39;, even_if_empty=True)  # unless you ask for it</span>
<span class="sd">    &#39;# &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">even_if_empty</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)))</span>


<div class="viewcode-block" id="ExampleX">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.ExampleX">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExampleX</span><span class="p">(</span><span class="n">doctest</span><span class="o">.</span><span class="n">Example</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;doctest.Example eXtended to have more convenient methods&quot;&quot;&quot;</span>

    <span class="n">source_prefix</span> <span class="o">=</span> <span class="s2">&quot;&gt;&gt;&gt; &quot;</span>
    <span class="n">source_continuation</span> <span class="o">=</span> <span class="s2">&quot;... &quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">want</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">exc_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lineno</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># if source is already a doctest.Example instance, use its properties as args</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">doctest</span><span class="o">.</span><span class="n">Example</span><span class="p">):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">exc_msg</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">o</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">want</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">exc_msg</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">exc_msg</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">indent_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_source_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indented_continuation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_continuation</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">indented_continuation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># remove the trailing &#39;...&#39; if present</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">indented_continuation</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">indented_continuation</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">want</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="p">:</span>
            <span class="n">want</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span> <span class="o">+</span> <span class="n">want</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_str</span> <span class="o">+</span> <span class="n">want</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>



<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>


<div class="viewcode-block" id="DoctestBlock">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.DoctestBlock">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DoctestBlock</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list that (should) contain doctest Example instances&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="p">()):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ExampleX</span><span class="p">,</span> <span class="n">seq</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;DoctestBlock with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>



<span class="n">parse_doctest</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTestParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span>


<span class="c1"># TODO: Newer, using doctest parser. See what can be merged</span>
<span class="c1">#  with non_doctest_lines etc.</span>
<div class="viewcode-block" id="split_text_and_doctests">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.split_text_and_doctests">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_text_and_doctests</span><span class="p">(</span><span class="n">doc_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates alternating blocks of &quot;text&quot; (string) and &quot;doctest blocks&quot;</span>
<span class="sd">    (``DoctestBlock`` instances, which are essentially a list of ``ExampleX`` instances).</span>

<span class="sd">    &gt;&gt;&gt; example = &#39;&#39;&#39;</span>
<span class="sd">    ...     This is to test the doctest splitter.</span>
<span class="sd">    ...     Until now, we&#39;re in a text block.</span>
<span class="sd">    ...     The following is a doctest block:</span>
<span class="sd">    ...</span>
<span class="sd">    ...     &gt;&gt;&gt; 2 + 3</span>
<span class="sd">    ...     5</span>
<span class="sd">    ...     &gt;&gt;&gt; t = 5</span>
<span class="sd">    ...     &gt;&gt;&gt; tt = 10</span>
<span class="sd">    ...</span>
<span class="sd">    ...     This is another text block, followed with another doctest block:</span>
<span class="sd">    ...</span>
<span class="sd">    ...     &gt;&gt;&gt; def foo():</span>
<span class="sd">    ...     ...     return 42</span>
<span class="sd">    ...     &gt;&gt;&gt; foo()</span>
<span class="sd">    ...     42</span>
<span class="sd">    ...</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; blocks = list(split_text_and_doctests(example))</span>

<span class="sd">    There are 5 blocks:</span>

<span class="sd">    &gt;&gt;&gt; len(blocks)</span>
<span class="sd">    5</span>

<span class="sd">    The first block is a string, corresponding to explanatory text of the doc string:</span>

<span class="sd">    &gt;&gt;&gt; isinstance(blocks[0], str)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; print(blocks[0])</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    This is to test the doctest splitter.</span>
<span class="sd">    Until now, we&#39;re in a text block.</span>
<span class="sd">    The following is a doctest block:</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    The next block is a ``DoctestBlock`` instance.</span>

<span class="sd">    &gt;&gt;&gt; block = blocks[1]</span>
<span class="sd">    &gt;&gt;&gt; isinstance(block, DoctestBlock)</span>
<span class="sd">    True</span>

<span class="sd">    This block has 3 elements (``ExampleX`` instances)</span>

<span class="sd">    &gt;&gt;&gt; len(block)</span>
<span class="sd">    3</span>

<span class="sd">    If you ask for the string representation of this block, you&#39;ll get a doctest string:</span>

<span class="sd">    &gt;&gt;&gt; str(block)</span>
<span class="sd">    &#39;    &gt;&gt;&gt; 2 + 3\n    5\n    &gt;&gt;&gt; t = 5\n    &gt;&gt;&gt; tt = 10\n&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_string</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">parse_doctest</span><span class="p">(</span><span class="n">doc_string</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">groupby</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">is_string</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_is_string</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_is_string</span><span class="p">:</span>
            <span class="k">yield</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">group_data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">DoctestBlock</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_data</span><span class="p">))</span></div>



<span class="n">comment_strip_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?m)^ *#.*\n?&quot;</span><span class="p">)</span>
<span class="n">doctest_line_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*&gt;&gt;&gt;&quot;</span><span class="p">)</span>
<span class="n">empty_line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*$&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="non_doctest_lines">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.non_doctest_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">non_doctest_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generator of lines of the doc string that are not in a doctest scope.</span>

<span class="sd">    &gt;&gt;&gt; def _test_func():</span>
<span class="sd">    ...     &#39;&#39;&#39;Line 1</span>
<span class="sd">    ...     Another</span>
<span class="sd">    ...     &gt;&gt;&gt; doctest_1</span>
<span class="sd">    ...     &gt;&gt;&gt; doctest_2</span>
<span class="sd">    ...     line_after_a_doc_test</span>
<span class="sd">    ...     another_line_that_is_in_the_doc_test scope</span>
<span class="sd">    ...</span>
<span class="sd">    ...     But now we&#39;re out of a doctest&#39;s scope</span>
<span class="sd">    ...</span>
<span class="sd">    ...     &gt;&gt;&gt; Oh no, another doctest!</span>
<span class="sd">    ...     &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; from inspect import getdoc</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; list(non_doctest_lines(getdoc(_test_func)))</span>
<span class="sd">    [&#39;Line 1&#39;, &#39;Another&#39;, &quot;But now we&#39;re out of a doctest&#39;s scope&quot;, &#39;&#39;]</span>

<span class="sd">    :param doc:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_line_was_a_doc_test</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">doctest_line_p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_line_was_a_doc_test</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">line</span>
                <span class="n">last_line_was_a_doc_test</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">empty_line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="n">last_line_was_a_doc_test</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_line_was_a_doc_test</span> <span class="o">=</span> <span class="kc">True</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">strip_comments</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">comment_strip_p</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mk_example_wants_callback</span><span class="p">(</span><span class="n">source_want_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">example_wants_callback</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">want</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">want</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">source_want_func</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">example</span><span class="o">.</span><span class="n">source</span>

    <span class="k">return</span> <span class="n">example_wants_callback</span>


<span class="k">def</span><span class="w"> </span><span class="nf">split_line_comments</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">comment</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_assert_wants</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">wrap_func_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">is_a_multiline</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_a_multiline</span><span class="p">:</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">split_line_comments</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wrap_func_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">) == </span><span class="si">{</span><span class="n">want</span><span class="si">}</span><span class="s2"> #</span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wrap_func_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">) == </span><span class="si">{</span><span class="n">wrap_func_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">want</span><span class="si">}</span><span class="s2">) #</span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">strchr</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="k">return</span> <span class="s2">&quot;assert </span><span class="si">{t}</span><span class="s2">, </span><span class="si">{strchr}{t}{strchr}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">strchr</span><span class="o">=</span><span class="n">strchr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">strchr</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;assert </span><span class="si">{t}</span><span class="s2">, </span><span class="si">{strchr}{t}{strchr}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">strchr</span><span class="o">=</span><span class="n">strchr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;assert </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if you didn&#39;t return before</span>
        <span class="k">if</span> <span class="n">wrap_func_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;actual = </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="se">\n</span><span class="s2">expected = </span><span class="si">{</span><span class="n">want</span><span class="si">}</span><span class="se">\n</span><span class="s2">assert actual == expected&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;actual = </span><span class="si">{</span><span class="n">wrap_func_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">expected = </span><span class="si">{</span><span class="n">wrap_func_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">want</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;assert actual == expected&quot;</span>
            <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_output_prefix</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;# OUTPUT: &quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">want</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>


<span class="n">output_prefix</span> <span class="o">=</span> <span class="n">mk_example_wants_callback</span><span class="p">(</span><span class="n">_output_prefix</span><span class="p">)</span>
<span class="n">assert_wants</span> <span class="o">=</span> <span class="n">mk_example_wants_callback</span><span class="p">(</span><span class="n">_assert_wants</span><span class="p">)</span>

<span class="c1"># def example_to_doctest_string(source, want):</span>
<span class="c1">#     want.replace()</span>
<span class="c1">#     return source +</span>


<span class="k">def</span><span class="w"> </span><span class="nf">doctest_string_trans_lines</span><span class="p">(</span>
    <span class="n">doctest_obj</span><span class="p">:</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTest</span><span class="p">,</span> <span class="n">example_callback</span><span class="o">=</span><span class="n">assert_wants</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">doctest_obj</span><span class="o">.</span><span class="n">examples</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">example_callback</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_doctest_string_gen</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">doctest_finder</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTestFinder</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">)</span>
    <span class="n">doctest_objs</span> <span class="o">=</span> <span class="n">doctest_finder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doctest_obj</span> <span class="ow">in</span> <span class="n">doctest_objs</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">doctest_string_trans_lines</span><span class="p">(</span><span class="n">doctest_obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="p">)</span>


<div class="viewcode-block" id="doctest_string">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.doctest_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doctest_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="o">=</span><span class="n">assert_wants</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the doctests found in given object.</span>

<span class="sd">    :param obj: Object (module, class, function, etc.) you want to extract doctests from.</span>
<span class="sd">    :params output_prefix:</span>
<span class="sd">    :param recurse: Whether the process should find doctests in the attributes of the object, recursively.</span>
<span class="sd">    :return: A string containing the doctests, with output lines prefixed by &#39;# Output:&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_doctest_string_gen</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">))</span></div>



<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="n">doctest_string</span><span class="o">.</span><span class="n">for_output_prefix</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">doctest_string</span><span class="p">,</span> <span class="n">example_callback</span><span class="o">=</span><span class="n">output_prefix</span>
<span class="p">)</span>
<span class="n">doctest_string</span><span class="o">.</span><span class="n">for_assert_wants</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">doctest_string</span><span class="p">,</span> <span class="n">example_callback</span><span class="o">=</span><span class="n">assert_wants</span><span class="p">)</span>


<div class="viewcode-block" id="doctest_string_print">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.doctest_string_print">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doctest_string_print</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="o">=</span><span class="n">assert_wants</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the doctests found in given object.</span>
<span class="sd">    :param obj: Object (module, class, function, etc.) you want to extract doctests from.</span>
<span class="sd">    :param recurse: Whether the process should find doctests in the attributes of the object, recursively.</span>
<span class="sd">    :return: A string containing the doctests, with output lines prefixed by &#39;# Output:&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">doctest_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">example_callback</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">))</span></div>



<div class="viewcode-block" id="old_doctest_string">
<a class="viewcode-back" href="../../module_docs/i2/doc_mint.html#i2.doc_mint.old_doctest_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">old_doctest_string</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="o">=</span><span class="s2">&quot;# OUTPUT: &quot;</span><span class="p">,</span>
    <span class="n">include_attr_without_doctests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the doctests found in given object.</span>
<span class="sd">    :param obj: Object (module, class, function, etc.) you want to extract doctests from.</span>
<span class="sd">    :param output_prefix:</span>
<span class="sd">    :param recurse: Whether the process should find doctests in the attributes of the object, recursively.</span>
<span class="sd">    :return: A string containing the doctests, with output lines prefixed by &#39;# Output:&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doctest_finder</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTestFinder</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">doctest_finder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">rr</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX_LINE_LENGTH</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">rr</span><span class="o">.</span><span class="n">examples</span><span class="p">:</span>
            <span class="n">want</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">want</span>
            <span class="n">want</span> <span class="o">=</span> <span class="n">want</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">source</span> <span class="o">+</span> <span class="n">_prefix_lines</span><span class="p">(</span><span class="n">want</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">output_prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_attr_without_doctests</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">ss</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># only append this attr if ss is non-empty</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">ss</span>
    <span class="k">return</span> <span class="n">s</span></div>



<span class="c1"># import sphinx</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">doctest_string</span><span class="p">(</span><span class="n">_prefix_lines</span><span class="p">))</span>
<span class="c1"># # _prefix_lines ########################################################</span>
<span class="c1">#</span>
<span class="c1"># _prefix_lines(&#39;something to comment out&#39;)</span>
<span class="c1"># # OUTPUT: &#39;# something to comment out&#39;</span>
<span class="c1"># _prefix_lines(&#39;A line you want to prefix&#39;, prefix=&#39;PREFIX: &#39;)</span>
<span class="c1"># # OUTPUT: &#39;PREFIX: A line you want to prefix&#39;</span>
<span class="c1"># print(_prefix_lines(&#39;What happens\nif the thing to comment out\nhas multiple lines?&#39;))</span>
<span class="c1"># # OUTPUT: # What happens</span>
<span class="c1"># # OUTPUT: # if the thing to comment out</span>
<span class="c1"># # OUTPUT: # has multiple lines?</span>
<span class="c1"># _prefix_lines(&#39;&#39;)  # see that an empty string is returned as is</span>
<span class="c1"># # OUTPUT: &#39;&#39;</span>
<span class="c1"># _prefix_lines(&#39;&#39;, even_if_empty=True)  # unless you ask for it</span>
<span class="c1"># # OUTPUT: &#39;# &#39;</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>